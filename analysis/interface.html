<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mind Parser</title>
    <link rel="stylesheet" href="./styles/css-reset.css">
    <link rel="stylesheet" href="./styles/styles.css">
    <script src="data.js"></script>
    <script src="env.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="menu-items">
        <button id="pre-filter" type="button">Pre filter</button>
        <button id="manual-filter" class="active" type="button">Manual filter</button>
        <button id="results" type="button">Results</button>
      </div>
      <div id="display"></div>
    </div>
    <script>
      const entries = data; // imported above
      const entriesLength = entries.length;
      const entryWeights = {}; // date: weight
      const filters = []; // strings stripped out of sample
      const preFilterBtn = document.getElementById('pre-filter');
      const manualFilterBtn = document.getElementById('manual-filter');
      const resultsBtn = document.getElementById('results');
      const display = document.getElementById('display');

      const preFilterHtml = `<h3>Enter filters separated by line breaks</h3>
        <textarea id="pre-filter-text"></textarea>
        <button id="update-pre-filter" type="button">update</button>`;

      const manualFilterHtml = `<span class="processed-counter">entry 1/1238</span>
        <h2 id="active-word" class="active-word"></h2>
        <p id="entry"></p>
        <div class="manual-filter-btns">
          <button id="negative" type="button">Negative</button>
          <button id="neutral" type="button">Neutral</button>
          <button id="positive" type="button">Positive</button>
        </div>`;
      
      let activeTab = 'manual-filter'; // id of tab button
      let processedEntries = 0;
      let activeEntryWords = []; // fill, unshift as processed

      // setup manual filter body
      display.innerHTML = manualFilterHtml; // yes you would not want to do this if stored eg. XSS

      // bind elements
      const negativeBtn = document.getElementById('negative'); // hungarian
      const neutralBtn = document.getElementById('neutral');
      const positiveBtn = document.getElementById('positive');
      const activeWord = document.getElementById('active-word');
      const activeEntry = document.getElementById('entry');
      const avoidChars = [' ', '.', ','];
      const avoidAcronyms = ['US'];

      const acronymMap = {
        'US': 'United States',
      };

      console.log(entries);

      const replaceAcronyms = (entry) => {
        const acronyms = Object.keys(acronymMap);
        let newEntry = entry;

        acronyms.forEach(acronym => {
          if (newEntry.indexOf(acronym) !== -1) {
            const regex = new RegExp(acronym, "g");
            newEntry = newEntry.replace(regex, acronymMap[acronym]);
          }
        })

        return newEntry;
      }

      const checkMailInfoText = (entry) => {
        if (entry.indexOf(filterStrings[0]) !== -1) {
          return entry.split(filterStrings[1]).join('');
        } else {
          return entry;
        }
      }

      const removeDateSent = (entry) => {
        // https://stackoverflow.com/a/69967785/2710227
        return entry.replaceAll(/\bOn\s+\w+\s+\d{1,2},\s*\d{4}\s*\d{1,2}:\d{1,2}\s*[AP]M,/gi, '');
      }

      const separateUppercase = (entry) => {
        let newStr = "";
        const entryChars = entry.split("");
        const entryCharLength = entryChars.length;

        entryChars.forEach((char, index) => {
          if (
            index > 1
            && avoidChars.indexOf(char) === -1
            && entry[index -1] !== ' '
            && char == char.toUpperCase()
          ) {
            newStr += ` ${char}`;
          } else {
            newStr += char;
          }
        });

        return newStr;
      }

      const cleanEntry = (entry) => {
        let cleanedEntry = entry;
        cleanedEntry = checkMailInfoText(entry); // e.g. On Feb 4, 2018 11:00 PM...

        if (entry !== cleanedEntry) { // means some removed
          cleanedEntry = removeDateSent(cleanedEntry);
        }

        cleanedEntry = replaceAcronyms(cleanedEntry);
        cleanedEntry = separateUppercase(cleanedEntry);

        return cleanedEntry;
      }

      const processWords = () => {

      };

      const processEntries = (entries) => {
        const entriesKeys = Object.keys(entries);

        if (entriesKeys.length > 0) {
          const firstEntryKey = entriesKeys[0];
          const firstEntry = entries[firstEntryKey];
          const cleanedEntry = cleanEntry(firstEntry);
          const activeEntryWords = cleanedEntry.split(' ');
          activeWord.innerText = activeEntryWords[0];
          activeEntry.innerText = cleanedEntry;
        }
      }

      // start the process
      processEntries(entries);
      
    </script>
  </body>
</html>